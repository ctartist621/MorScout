<!DOCTYPE html>
<html lang="en">

  <head>

  	<meta charset="utf-8" />
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MorScout</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Exo+2:100' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="css/index.css" type="text/css">

    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>

    <script>
    $(document).on('mobileinit', function () {
        $.mobile.ignoreContentEnabled = true;
    });
    </script>

    <script type="text/javascript">
    $(document).on('pagecreate', '#indexPage', function(){        
        $( document ).on( "swiperight", "#indexPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pagebeforeshow', '#matchesPage', function(){ 
      if(localStorage.hasLoggedIn == "true"){
          var jsonfile = JSON.parse(localStorage.matches);
          var table = document.createElement('table');
          
          var header_row = document.createElement('tr');
          
          var th1 = document.createElement('th');
          var th2 = document.createElement('th');
          var th3 = document.createElement('th');
          var th4 = document.createElement('th');
          var th5 = document.createElement('th');
          th4.colSpan = "3";
          th5.colSpan = "3";

          $(th4).addClass('matchesTableHide');
          $(th5).addClass('matchesTableHide');
          
          var th_text1 = document.createTextNode("#");
          var th_text2 = document.createTextNode("Time");
          var th_text3 = document.createTextNode("Scouted");
          var th_text4 = document.createTextNode("Red Teams");
          var th_text5 = document.createTextNode("Blue Teams");
          
          th1.appendChild(th_text1);
          th2.appendChild(th_text2);
          th3.appendChild(th_text3);
          th4.appendChild(th_text4);
          th5.appendChild(th_text5);
          
          header_row.appendChild(th1);
          header_row.appendChild(th2);
          header_row.appendChild(th3);
          header_row.appendChild(th4);
          header_row.appendChild(th5);
          
          table.appendChild(header_row);
          
          for (match_number = 0 ; match_number < Object.keys(jsonfile).length  ; match_number++) {
              
              var real_match_number = Object.keys(jsonfile)[match_number];
              var real_match_number_plus_one = Object.keys(jsonfile)[match_number+1];
              
              var tr = document.createElement('tr');
               
              var td1 = document.createElement('td');
              var td2 = document.createElement('td');
              var td3 = document.createElement('td');
              var td4 = document.createElement('td');
              var td5 = document.createElement('td');
              var td6 = document.createElement('td');
              var td7 = document.createElement('td');
              var td8 = document.createElement('td');
              var td9 = document.createElement('td');

              $(td4).addClass('matchesTableHide');
              $(td5).addClass('matchesTableHide');
              $(td6).addClass('matchesTableHide');
              $(td7).addClass('matchesTableHide');
              $(td8).addClass('matchesTableHide');
              $(td9).addClass('matchesTableHide');

              var text1 = document.createTextNode(real_match_number);
              // var text2 = document.createTextNode(jsonfile[real_match_number].time);
              var d = new Date();
              var text2 = document.createTextNode(d.getHours()+":"+d.getMilliseconds()%60 + " PM");
              // var text3 = document.createTextNode(jsonfile[real_match_number].scouted);
              var text3 = document.createTextNode("No");
              var text4 = document.createTextNode(jsonfile[real_match_number].red[0]);
              var text5 = document.createTextNode(jsonfile[real_match_number].red[1]);
              var text6 = document.createTextNode(jsonfile[real_match_number].red[2]);
              var text7 = document.createTextNode(jsonfile[real_match_number].blue[0]);
              var text8 = document.createTextNode(jsonfile[real_match_number].blue[1]);
              var text9 = document.createTextNode(jsonfile[real_match_number].blue[2]);

              td1.appendChild(text1);
              td2.appendChild(text2);
              td3.appendChild(text3);
              td4.appendChild(text4);
              td5.appendChild(text5);
              td6.appendChild(text6);
              td7.appendChild(text7);
              td8.appendChild(text8);
              td9.appendChild(text9);
              
              tr.appendChild(td1);
              tr.appendChild(td2);
              tr.appendChild(td3);
              tr.appendChild(td4);
              tr.appendChild(td5);
              tr.appendChild(td6);
              tr.appendChild(td7);
              tr.appendChild(td8);
              tr.appendChild(td9);

              table.appendChild(tr);
              
              /*var time = new Date();
              if(real_match_number_plus_one !== undefined){
                if(toMilitary(jsonfile[real_match_number].time) <= getMilitary(time) && getMilitary(time) < toMilitary(jsonfile[real_match_number_plus_one].time)){
                  $(tr).addClass('current_match');
                }else{
                  $(tr).removeClass('current_match');
                }
              } else {
                if(toMilitary(jsonfile[real_match_number].time) <= getMilitary(time) && getMilitary(time) < addMinutes(toMilitary(jsonfile[real_match_number].time), 5)){
                  $(tr).addClass('current_match');
                }
              }*/
          }
          
          $('#matchesPage').append(table);
          
          $('#loadingMatches').hide();
          $("tr:odd").addClass("odd_row");
          $("tr:first").addClass("first_row");
          $(table).addClass('matches_table')
          
          $('tr').not(".first_row").mouseenter(function(){
              $(this).addClass('table_hover')
          });
          
          $('tr').not(".first_row").mouseleave(function(){
              $(this).removeClass('table_hover')
          });

          $('tr').not(".first_row").bind('touchstart',function(){
              $(this).addClass('table_hover')
          });
          
          $('tr').not(".first_row").bind('touchend',function(){
              $(this).removeClass('table_hover')
          });
          
          $('tr').not(".first_row").click(function(){
            localStorage.match = $(this).children(":first").text();
            localStorage.time = $(this).children(":first").next().text();
              location = "report.html?" + getQS({"match" : $(this).children(":first").text(), "time" : $(this).children(":first").next().text()});
          });

          if(window.innerWidth<630){
            $('.matchesTableHide').hide();
          }else{
            $('.matchesTableHide').show();
          }

          var $rows = $('.matches_table tr');
          $('#search').keyup(function() {
            $('tr').removeClass('odd_row');
              var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
              if(val==""){
                $("tr:odd").addClass("odd_row");
              }

              $rows.show().filter(function() {
                  var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
                  return !~text.indexOf(val);
              }).hide();
              $(".first_row").show();
          });

        }else{
          $('#search').hide();
        $('#loadingMatches').html('Log in first!');
        setTimeout(function(){
          location = "login.html";
        }, 1000)
        };
    });
    $(document).on('pagecreate', '#matchesPage', function(){ 
        $( document ).on( "swiperight", "#matchesPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pageremove', '#matchesPage', function(){ 
      $(".matches_table").remove();
    });
    $(document).on('pagecreate', '#teamsPage', function(){      
        $( document ).on( "swiperight", "#teamsPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pagecreate', '#syncPage', function(){
        $('#loadingSync').hide();
        $('#sync_button').click(function(){
          $(this).fadeOut(300);
          $('#loadingSync').fadeIn(300);
          sync();
        });      
        $( document ).on( "swiperight", "#syncPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pagecreate', '#settingsPage', function(){ 
        $('#ip_button').hover(function() {
          $(this).toggleClass('button_hovered')
        });
        $('#ip_button').bind('touchstart',function() {
          $(this).addClass('button_hovered')
        });
        $('#ip_button').bind('touchend',function() {
          $(this).removeClass('button_hovered')
        });
        $('#ip_button').click(function(){
          if(document.getElementById('ip_text').value !== ""){
            localStorage.ip = document.getElementById('ip_text').value;
            $('#ip_text').attr('placeholder', localStorage.ip);
          } else {
            alert("IP can not be empty!");
          }
        });

        $('#port_button').hover(function() {
          $(this).toggleClass('button_hovered')
        });
        $('#port_button').bind('touchstart',function() {
          $(this).addClass('button_hovered')
        });
        $('#port_button').bind('touchend',function() {
          $(this).removeClass('button_hovered')
        });
        $('#port_button').click(function(){
          if(document.getElementById('port_text').value !== ""){
            localStorage.port = document.getElementById('port_text').value;
            $('#port_text').attr('placeholder', localStorage.port);
          } else {
            alert("Port can not be empty!");
          } 
        });

        $('#ip_text').val(localStorage.ip);
        $('#port_text').val(localStorage.port);
        $('#ip_text').attr('placeholder', localStorage.ip);
        $('#port_text').attr('placeholder', localStorage.port);   

        $( document ).on( "swiperight", "#settingsPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pagecreate', '#helpPage', function(){      
        $( document ).on( "swiperight", "#helpPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pagecreate', '#feedbackPage', function(){      
        $( document ).on( "swiperight", "#feedbackPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    $(document).on('pagecreate', '#loginPage', function(){
        sessionStorage.removeItem('user') 
        sessionStorage.removeItem('token')
        if(localStorage.ip == undefined){
          localStorage.ip = "localhost";
        }
        if(localStorage.port == undefined){
          localStorage.port = "8080";
        }
        $('#login_button').hover(function() {
          $(this).toggleClass('button_hovered')
        });
        $('#login_button').bind('touchstart',function() {
          $(this).addClass('button_hovered')
        });
        $('#login_button').bind('touchend',function() {
          $(this).removeClass('button_hovered')
        });
        if($(window).width()<768){
          $('.current_page').show();
        }else{
          $('.current_page').hide();
        }    
        $( document ).on( "swiperight", "#loginPage", function( e ) {
          if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
            if (e.type === "swiperight") {
                console.log("swipe");
                $( "#leftPanel" ).panel( "open" );
            }  
          }        
        });
    });
    </script>

    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <script id="panel-init">
    $(function() {
      $( "body>[data-role='panel']" ).panel().enhanceWithin();
    });
    </script>

    <script src="js/main.js" type="text/javascript"></script>

  </head>

<body>
  <div data-role="page" id="indexPage" data-theme="b">  

    <div data-role="header" data-position="fixed">
      <a href="#leftPanel" class="ui-btn" id="bars"><span class="glyphicon glyphicon-menu-hamburger"></span></a>
      <h1>MorScout</h1>
    </div>

    <div data-role="content" class="ui-content" data-enhance="false">
      <div class="main_welcome">
      <div class="container">
       <div class="row">
        <div class="col-md-4">
        </div>
        <div class="col-md-4">
         <h1>MorScout</h1>
         <!-- <h3>Welcome to MorScout!</h3> -->
         <h3>OurScout is MorScout Than YourScout</h3>
        </div>
        <div class="col-md-4">
        </div>
       </div>
      </div>
     </div> 
    </div>

  </div>

    <div data-role="panel" id="leftPanel" data-display="overlay" data-position-fixed="true" data-theme="b"> 
      <div data-role="controlgroup" data-corners="false">
          <a href="index.html" data-transition="none" data-role="button" id="panelLink">Home</a>
          <a href="matches.html" data-transition="none" data-role="button" id="panelLink">All Matches</a>
          <a href="teams.html" data-transition="none" data-role="button" id="panelLink">Team List</a>
          <a href="sync.html" data-transition="none" data-role="button" id="panelLink">Sync</a>
          <a href="settings.html" data-transition="none" data-role="button" id="panelLink">Settings</a>
          <a href="help.html" data-transition="none" data-role="button" id="panelLink">Help</a>
          <a href="feedback.html" data-transition="none" data-role="button" id="panelLink">Feedback</a>
          <a href="login.html" data-transition="none" data-role="button" id="panelLink">Log in</a>
      </div>
    </div>  

</body>
</html>