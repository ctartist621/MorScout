<html><head><script>

function getQS(obj) {
	var arr = Object.keys(obj);
	for(var i = 0; i < arr.length; i++) {
		arr[i] = escape(arr[i]) + "=" + escape(obj[arr[i]]);
	}
	return arr.join("&");
}
function parseQS(str) {
	var arr = str.split("&");
	var obj = {};
	for(var i = 0; i < arr.length; i++) {
		var pair = arr[i].split("=");
		obj[unescape(pair[0])] = unescape(pair[1] || "");
	}
	return obj;
}
function ajax(url, post, cb) {
	var xhr = new XMLHttpRequest() || new XDomainRequest();
	xhr.onload = function() {
		if(cb) {
			cb(parseQS(xhr.responseText));
		}
	};
	xhr.open("POST", "http://localhost:8080" + url, true);
	xhr.send(getQS(post));
}

window.onload = function() {
	ajax("/login", {"user" : "BenH", "pass" : "pigeon"}, function(result) {
		if(result.code == 0) {
			var user = result.user;
			var token = result.token;
			ajax("/sync", {"user" : user, "token" : token, "allData" : "", "data" : JSON.stringify([{
				"meta" : {
					"team" : "1515",
					"match" : "15",
					"scout" : "george",
					"time" : new Date().getTime()
				},
				"data" : {}
			},{
				"meta" : {
					"team" : "1515",
					"match" : "15",
					"scout" : "bob",
					"time" : new Date().getTime() - 2000
				},
				"data" : {}
			}])}, function(result){
				if(result.code == 0) {
					document.body.innerHTML = result.data;
					ajax("/logout", {"user" : user, "token" : token});
				}
			});
		}
	});
}

</script></head></html>